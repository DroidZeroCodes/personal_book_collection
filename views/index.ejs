<%- include('partials/header.ejs') %>
    <main class="container h-auto mt-4">
        <div class="row text-center my-5">
            <h2 class="display-5 fw-bold text-dark">Welcome to Book Notes</h2>
            <p class="text-secondary fs-5">Your personal space to manage and review your book collection.</p>
        </div>

        <hr class="my-5">

        <% const statusMap={ 'not_started' : { text: 'Not Started' , class: 'bg-secondary-subtle text-secondary' ,
            icon: 'bi-bookmark' }, 'reading' : { text: 'Currently Reading' , class: 'bg-primary-subtle text-primary' ,
            icon: 'bi-book' }, 'finished' : { text: 'Finished' , class: 'bg-success-subtle text-success' ,
            icon: 'bi-check-circle' } }; %>

            <div class="row mb-5">
                <div class="col-12">
                    <h3 class="fw-bold mb-4">Recent Activity</h3>
                </div>

                <% if (books.length> 0) { %>
                    <div class="d-flex flex-wrap gap-4 justify-content-start">
                        <% books.forEach(function(book) { const currentStatusKey=book.status && statusMap[book.status] ?
                            book.status : 'not_started' ; const currentStatus=statusMap[currentStatusKey] || {
                            text: 'Unknown' , class: 'bg-danger-subtle text-danger' , icon: 'bi-question-circle' }; %>
                            <div class="card shadow-sm border-0 rounded-4" style="width: 200px;">
                                <a href="/books/<%= book.olid %>" class="text-decoration-none text-dark">
                                    <% if (book.cover_edition_key) { %>
                                        <img class="card-img-top object-fit-cover rounded-top-4"
                                            src="https://covers.openlibrary.org/b/olid/<%= book.cover_edition_key %>-L.jpg"
                                            alt="<%= book.title %> Cover" style="height: 250px;" loading="lazy">
                                        <% } else { %>
                                            <div class="bg-secondary-subtle d-flex align-items-center justify-content-center rounded-top-4"
                                                style="height: 250px;">
                                                <i class="bi bi-book text-secondary fs-1"></i>
                                            </div>
                                            <% } %>

                                                <div class="card-body p-3">
                                                    <h5 class="card-title fw-semibold fs-6 mb-1 text-truncate"
                                                        title="<%= book.title %>">
                                                        <%= book.title %>
                                                    </h5>
                                                    <p class="card-text text-secondary small text-truncate">
                                                        <%= book.author %>
                                                    </p>
                                                </div>
                                </a>

                                <div
                                    class="card-footer d-flex align-items-center justify-content-between bg-white border-0 py-2 px-3 rounded-bottom-4">
                                    <% if (book.rating && book.rating> 0) { %>
                                        <div class="text-warning small me-2">
                                            <% for( let index=0; index < book.rating; index++ ) { %>
                                                ‚≠ê
                                                <% } %>
                                        </div>
                                        <% } %>

                                            <span
                                                class="badge <%= currentStatus.class %> px-2 py-1 rounded-pill small ms-auto d-flex align-items-center gap-1">
                                                <i class="bi <%= currentStatus.icon %>"></i>
                                                <%= currentStatus.text %>
                                            </span>
                                </div>
                            </div>
                            <% }); %>
                    </div>
                    <% } else { %>
                        <div class="col-12">
                            <div class="alert alert-info py-4 text-center rounded-4 shadow-sm">
                                <h4 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Your Library is Empty
                                </h4>
                                <p class="mb-0">Add a book to your collection to see your recent activity here.</p>
                            </div>
                        </div>
                        <% } %>
            </div>
    </main>

    <%- include('partials/footer.ejs') %>