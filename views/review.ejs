<%- include('partials/header.ejs') %>

    <main class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">

                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/books"
                                class="text-decoration-none text-secondary">Library</a></li>
                        <li class="breadcrumb-item"><a href="/books/<%= book.id %>"
                                class="text-decoration-none text-secondary">
                                <%= book.title %>
                            </a></li>
                        <li class="breadcrumb-item active" aria-current="page">Review</li>
                    </ol>
                </nav>

                <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                    <div class="card-body p-0 d-flex flex-column flex-md-row">

                        <div class="bg-light p-4 col-md-4 text-center d-flex flex-column align-items-center border-end">
                            <div class="shadow-sm rounded-3 overflow-hidden mb-3" style="width: 140px;">
                                <% if (book.cover_edition_key) { %>
                                    <img src="https://covers.openlibrary.org/b/olid/<%= book.cover_edition_key %>-L.jpg"
                                        class="img-fluid" alt="Cover">
                                    <% } else { %>
                                        <div
                                            class="bg-secondary-subtle ratio ratio-2x3 d-flex align-items-center justify-content-center">
                                            <i class="bi bi-book text-secondary fs-2"></i>
                                        </div>
                                        <% } %>
                            </div>
                            <h5 class="fw-bold mb-1">
                                <%= book.title %>
                            </h5>
                            <p class="text-secondary small">
                                <%= book.author %>
                            </p>

                            <% if (review) { %>
                                <div class="mt-auto pt-3 w-100">
                                    <form action="/books/<%= book.id %>/review/delete" method="POST"
                                        onsubmit="return confirm('Are you sure you want to delete this review?');">
                                        <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                                            <i class="bi bi-trash me-1"></i>Delete Review
                                        </button>
                                    </form>
                                </div>
                                <% } %>
                        </div>

                        <div class="p-4 p-lg-5 col-md-8">
                            <h3 class="fw-bold mb-4">
                                <%= review ? 'Edit Review' : 'Write a Review' %>
                            </h3>

                            <form action="/books/<%= book.id %>/review" method="POST">

                                <div class="mb-4">
                                    <label class="form-label fw-bold small text-uppercase text-secondary">Your
                                        Rating</label>
                                    <div class="input-group">
                                        <select name="rating" class="form-select form-select-lg border-secondary-subtle"
                                            required>
                                            <option value="" disabled <%=!review ? 'selected' : '' %>>Select Rating
                                            </option>
                                            <option value="5" <%=(review && review.rating==5) ? 'selected' : '' %>>⭐⭐⭐⭐⭐
                                                (Excellent)</option>
                                            <option value="4" <%=(review && review.rating==4) ? 'selected' : '' %>>⭐⭐⭐⭐
                                                (Good)</option>
                                            <option value="3" <%=(review && review.rating==3) ? 'selected' : '' %>>⭐⭐⭐
                                                (Average)</option>
                                            <option value="2" <%=(review && review.rating==2) ? 'selected' : '' %>>⭐⭐
                                                (Poor)</option>
                                            <option value="1" <%=(review && review.rating==1) ? 'selected' : '' %>>⭐
                                                (Terrible)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label for="content"
                                        class="form-label fw-bold small text-uppercase text-secondary">Your
                                        Thoughts</label>
                                    <textarea name="content" id="content" rows="8"
                                        class="form-control border-secondary-subtle p-3"
                                        placeholder="What did you think about this book? What were your favorite parts?"
                                        required><%= review ? review.content : '' %></textarea>
                                </div>

                                <div class="d-flex justify-content-end gap-2">
                                    <a href="/books/<%= book.id %>" class="btn btn-light px-4">Cancel</a>
                                    <button type="submit" class="btn btn-dark px-4 rounded-pill">
                                        <%= review ? 'Update Review' : 'Publish Review' %>
                                    </button>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>

                <div class="mt-5 text-center">
                    <p class="text-secondary small">Want to remove this book from your library entirely?</p>
                    <form action="/books/<%= book.id %>/delete" method="POST"
                        onsubmit="return confirm('This will remove the book and your review from your library. This cannot be undone.');">
                        <button type="submit" class="btn btn-link text-danger text-decoration-none small p-0">
                            Remove Book from Library
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </main>

    <%- include('partials/footer.ejs') %>